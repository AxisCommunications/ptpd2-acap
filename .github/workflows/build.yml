---
name: Build ACAPs

on:
  pull_request:
    types: [opened, reopened]
  push:

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      DEBIAN_FRONTEND: noninteractive
    steps:
      - uses: actions/checkout@v3
      # Test all Makefile targets and make sure the ACAP files are created
      - name: Build ACAPs
        run: make -j
      - name: Verify ACAPs
        run: |
          for a in armv7hf aarch64; do
          echo "Verification of $a ACAP"
          tar tzf eap/*$a.eap >/dev/null
          done
      - name: Clean
        run: |
          make clean
          echo 'Making sure ACAP files were cleaned by `make clean`'
          [ ! -d eap ]
